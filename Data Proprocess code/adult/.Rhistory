cols <- append(cols, min(which(a == TRUE)))
}else{
cols <- append(cols, which(a == TRUE))
}
}
data_enc <- data_enc[,cols]
data_enc$target <- data$target
# Taking care of  the integer columns : If x_ij = 1 then x_i(j+1) should be one as well  for odd i's
features = c('fnlwgt','hours_per_week','capital','age_group')
for(v in features){
for(i in seq(2,nlevels(data[[v]]),1)){
a =  as.numeric(as.character(data_enc[[paste(v,toString(i),sep = ".")]]))
b =  as.numeric(as.character(data_enc[[paste(v,toString(i-1),sep = ".")]]))
data_enc[[paste(v,toString(i),sep = ".")]] =  as.numeric(a|b)
}
}
View(data)
View(data_enc)
summary(data)
names(data_enc)
View(data_enc)
write.csv(data,"adult.csv",row.names = FALSE)
write.csv(data_enc,"adult_enc.csv",row.names = FALSE)
# Choose the seeds
seeds = c(123,156,67,1,43)
for(Run in c(1,2,3,4,5)){
set.seed(seeds[Run])
##########################################################################################################
# Splitting data into training and test
##########################################################################################################
smp_size = 8000
## set the seed to make your partition reproducible
sample_ind <- sample(seq_len(nrow(data)), size = smp_size)
data_sample <- data[sample_ind, ]
data_sample_enc <- data_enc[sample_ind, ]
# Save files
write.csv(data_sample,paste("adult_sample_",toString(Run),".csv",sep=''),row.names = FALSE)
write.csv(data_sample_enc,paste("adult_sample_enc_",toString(Run),".csv",sep=''),row.names = FALSE)
}
names(data)
names(data_enc)
summary(data)
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE )
library(kableExtra)
library(png)
library(ggplot2)
library(reshape2)
library(egg)
require(tidyr)
require(dplyr)
library(dplyr)
library(latex2exp)
# library(ggpubr)
library(data.table)
library(RColorBrewer)
library(MASS)
require(scales)
rm(list=ls())
data= read.csv('./../Results/FairOCT_Compass_10800_May_20.csv', header=TRUE, sep=',', na.strings="", stringsAsFactors =TRUE)
forpres=TRUE
if (forpres){
fontfam = "sans"
} else {
fontfam = "serif"
}
figure_path = "./"
data$sample <- as.factor(data$sample)
View(data)
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE )
library(kableExtra)
library(png)
library(ggplot2)
library(reshape2)
library(egg)
require(tidyr)
require(dplyr)
library(dplyr)
library(latex2exp)
# library(ggpubr)
library(data.table)
library(RColorBrewer)
library(MASS)
require(scales)
rm(list=ls())
data= read.csv('./../Results/FairOCT_Compass_10800_May_20.csv', header=TRUE, sep=',', na.strings="", stringsAsFactors =TRUE)
forpres=TRUE
if (forpres){
fontfam = "sans"
} else {
fontfam = "serif"
}
figure_path = "./"
data$sample <- as.factor(data$sample)
data$depth <- as.factor(data$depth)
data$fair.type <- as.factor(data$fair.type)
data$fair.bound <- as.factor(data$fair.bound)
for(i in c('SP','CSP','PE','EOpp','EOdds')){
tmp_none <- data[data$fair.type == 'None',]
tmp_none$fair.type = i
data = rbind(data,tmp_none)
}
data <- data[data$fair.type!= 'None',]
rm(tmp_none)
tmp <- data
tmp <- tmp %>%
group_by(approach,data,depth, fair.type, fair.bound) %>%
summarise(mean(train.acc),mean(test.acc),mean(sp.train.data), mean(sp.train.pred),
mean(sp.test.data),mean(sp.test.pred),
mean(csp.train.data), mean(csp.train.pred),
mean(csp.test.data),mean(csp.test.pred),
mean(pe.train.data), mean(pe.train.pred),
mean(pe.test.data),mean(pe.test.pred),
mean(EOpp.train.data), mean(EOpp.train.pred),
mean(EOpp.test.data),mean(EOpp.test.pred))
View(data)
View(tmp)
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE )
library(kableExtra)
library(png)
library(ggplot2)
library(reshape2)
library(egg)
require(tidyr)
require(dplyr)
library(dplyr)
library(latex2exp)
# library(ggpubr)
library(data.table)
library(RColorBrewer)
library(MASS)
require(scales)
rm(list=ls())
data= read.csv('./../Results/FairOCT_COMPAS_10800_May_20.csv', header=TRUE, sep=',', na.strings="", stringsAsFactors =TRUE)
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE )
library(kableExtra)
library(png)
library(ggplot2)
library(reshape2)
library(egg)
require(tidyr)
require(dplyr)
library(dplyr)
library(latex2exp)
# library(ggpubr)
library(data.table)
library(RColorBrewer)
library(MASS)
require(scales)
rm(list=ls())
data= read.csv('./../Results/FairOCT_Compass_10800_May_20.csv', header=TRUE, sep=',', na.strings="", stringsAsFactors =TRUE)
forpres=TRUE
if (forpres){
fontfam = "sans"
} else {
fontfam = "serif"
}
figure_path = "./"
data$sample <- as.factor(data$sample)
data$depth <- as.factor(data$depth)
data$fair.type <- as.factor(data$fair.type)
data$fair.bound <- as.factor(data$fair.bound)
for(i in c('SP','CSP','PE','EOpp','EOdds')){
tmp_none <- data[data$fair.type == 'None',]
tmp_none$fair.type = i
data = rbind(data,tmp_none)
}
data <- data[data$fair.type!= 'None',]
rm(tmp_none)
View(data)
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE )
library(kableExtra)
library(png)
library(ggplot2)
library(reshape2)
library(egg)
require(tidyr)
require(dplyr)
library(dplyr)
library(latex2exp)
# library(ggpubr)
library(data.table)
library(RColorBrewer)
library(MASS)
require(scales)
rm(list=ls())
data= read.csv('./../Results/FairOCT_Compass_10800_May_20.csv', header=TRUE, sep=',', na.strings="", stringsAsFactors =TRUE)
forpres=TRUE
if (forpres){
fontfam = "sans"
} else {
fontfam = "serif"
}
figure_path = "./"
data$sample <- as.factor(data$sample)
data$depth <- as.factor(data$depth)
data$fair.type <- as.factor(data$fair.type)
data$fair.bound <- as.factor(data$fair.bound)
for(i in c('SP','CSP','PE','EOpp','EOdds')){
tmp_none <- data[data$fair.type == 'None',]
tmp_none$fair.type = i
data = rbind(data,tmp_none)
}
data <- data[data$fair.type!= 'None',]
rm(tmp_none)
tmp <- data
tmp <- tmp %>%
group_by(approach,data,depth, fair.type, fair.bound) %>%
summarise(mean(train.acc),mean(test.acc),mean(sp.train.data), mean(sp.train.pred),
mean(sp.test.data),mean(sp.test.pred),
mean(csp.train.data), mean(csp.train.pred),
mean(csp.test.data),mean(csp.test.pred),
mean(pe.train.pred),
mean(pe.test.pred),
mean(EOpp.train.pred),
mean(EOpp.test.pred),
mean(EOdds.train.pred),
mean(EOdds.test.pred))
names(tmp) <- c("approach","data","depth","fair.type","fair.bound","train.acc",'test.acc',
"train.data.sp","train.pred.sp","test.data.sp","test.pred.sp",
"train.data.csp","train.pred.csp","test.data.csp","test.pred.csp",
"train.pred.pe","test.pred.pe",
"train.pred.EOpp","test.pred.EOpp",
"train.pred.EOdds","test.pred.EOdds")
tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","train.acc",
'train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp')]
tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'train.acc'))
# tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","test.acc",
#              'test.pred.sp','test.pred.csp','test.pred.pe','test.pred.EOpp')]
# tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'test.acc'))
g1 <- ggplot(data = subset(tmp,tmp$depth ==2), aes(x=(1-value)*100, y=train.acc*100)) +
geom_point()+#aes(size = fair.bound)
geom_text(aes(label = fair.bound),
vjust = "inward", hjust = "inward",check_overlap = TRUE, nudge_y = 5,nudge_x = 4,
show.legend = FALSE,size = 3) +
geom_line(aes(color = variable)) +
facet_grid(vars(fair.type), vars(variable))+
labs(x="Fairness (%)", y = "Accuracy (%)", linetype = "Constraint")+
theme(
# plot.title = element_text(size = 25),
axis.title = element_text(size = 29)
)
print(g1)
if (forpres)
{
ggsave(paste(figure_path,"grid_train.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
} else {
ggsave(paste(figure_path,"grid_train.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
}
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE )
library(kableExtra)
library(png)
library(ggplot2)
library(reshape2)
library(egg)
require(tidyr)
require(dplyr)
library(dplyr)
library(latex2exp)
# library(ggpubr)
library(data.table)
library(RColorBrewer)
library(MASS)
require(scales)
rm(list=ls())
data= read.csv('./../Results/FairOCT_Compass_10800_May_20.csv', header=TRUE, sep=',', na.strings="", stringsAsFactors =TRUE)
forpres=TRUE
if (forpres){
fontfam = "sans"
} else {
fontfam = "serif"
}
figure_path = "./"
data$sample <- as.factor(data$sample)
data$depth <- as.factor(data$depth)
data$fair.type <- as.factor(data$fair.type)
data$fair.bound <- as.factor(data$fair.bound)
for(i in c('SP','CSP','PE','EOpp','EOdds')){
tmp_none <- data[data$fair.type == 'None',]
tmp_none$fair.type = i
data = rbind(data,tmp_none)
}
data <- data[data$fair.type!= 'None',]
rm(tmp_none)
tmp <- data
tmp <- tmp %>%
group_by(approach,data,depth, fair.type, fair.bound) %>%
summarise(mean(train.acc),mean(test.acc),mean(sp.train.data), mean(sp.train.pred),
mean(sp.test.data),mean(sp.test.pred),
mean(csp.train.data), mean(csp.train.pred),
mean(csp.test.data),mean(csp.test.pred),
mean(pe.train.pred),
mean(pe.test.pred),
mean(EOpp.train.pred),
mean(EOpp.test.pred),
mean(EOdds.train.pred),
mean(EOdds.test.pred))
names(tmp) <- c("approach","data","depth","fair.type","fair.bound","train.acc",'test.acc',
"train.data.sp","train.pred.sp","test.data.sp","test.pred.sp",
"train.data.csp","train.pred.csp","test.data.csp","test.pred.csp",
"train.pred.pe","test.pred.pe",
"train.pred.EOpp","test.pred.EOpp",
"train.pred.EOdds","test.pred.EOdds")
tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","train.acc",
'train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp','train.pred.EOdds')]
tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'train.acc'))
# tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","test.acc",
#              'test.pred.sp','test.pred.csp','test.pred.pe','test.pred.EOpp','test.pred.EOdds')]
# tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'test.acc'))
g1 <- ggplot(data = subset(tmp,tmp$depth ==2), aes(x=(1-value)*100, y=train.acc*100)) +
geom_point()+#aes(size = fair.bound)
geom_text(aes(label = fair.bound),
vjust = "inward", hjust = "inward",check_overlap = TRUE, nudge_y = 5,nudge_x = 4,
show.legend = FALSE,size = 3) +
geom_line(aes(color = variable)) +
facet_grid(vars(fair.type), vars(variable))+
labs(x="Fairness (%)", y = "Accuracy (%)", linetype = "Constraint")+
theme(
# plot.title = element_text(size = 25),
axis.title = element_text(size = 29)
)
print(g1)
if (forpres)
{
ggsave(paste(figure_path,"grid_train.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
} else {
ggsave(paste(figure_path,"grid_train.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
}
names(tmp)
summary(tmp)
tmp <- data
tmp <- tmp %>%
group_by(approach,data,depth, fair.type, fair.bound) %>%
summarise(mean(train.acc),mean(test.acc),mean(sp.train.data), mean(sp.train.pred),
mean(sp.test.data),mean(sp.test.pred),
mean(csp.train.data), mean(csp.train.pred),
mean(csp.test.data),mean(csp.test.pred),
mean(pe.train.pred),
mean(pe.test.pred),
mean(EOpp.train.pred),
mean(EOpp.test.pred),
mean(EOdds.train.pred),
mean(EOdds.test.pred))
names(tmp) <- c("approach","data","depth","fair.type","fair.bound","train.acc",'test.acc',
"train.data.sp","train.pred.sp","test.data.sp","test.pred.sp",
"train.data.csp","train.pred.csp","test.data.csp","test.pred.csp",
"train.pred.pe","test.pred.pe",
"train.pred.EOpp","test.pred.EOpp",
"train.pred.EOdds","test.pred.EOdds")
tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","train.acc",
'train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp','train.pred.EOdds')]
tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'train.acc'))
# tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","test.acc",
#              'test.pred.sp','test.pred.csp','test.pred.pe','test.pred.EOpp','test.pred.EOdds')]
# tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'test.acc'))
tmp$fair.type <- factor(tmp$fair.type, levels = c('SP','CSP','PE','EOpp','EOdds'))
tmp$variable <- factor(tmp$variable, levels = c('train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp','train.pred.EOdds'))
g1 <- ggplot(data = subset(tmp,tmp$depth ==2), aes(x=(1-value)*100, y=train.acc*100)) +
geom_point()+#aes(size = fair.bound)
geom_text(aes(label = fair.bound),
vjust = "inward", hjust = "inward",check_overlap = TRUE, nudge_y = 5,nudge_x = 4,
show.legend = FALSE,size = 3) +
geom_line(aes(color = variable)) +
facet_grid(vars(fair.type), vars(variable))+
labs(x="Fairness (%)", y = "Accuracy (%)", linetype = "Constraint")+
theme(
# plot.title = element_text(size = 25),
axis.title = element_text(size = 29)
)
print(g1)
if (forpres)
{
ggsave(paste(figure_path,"grid_train.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
} else {
ggsave(paste(figure_path,"grid_train.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
}
tmp <- data
tmp <- tmp %>%
group_by(approach,data,depth, fair.type, fair.bound) %>%
summarise(mean(train.acc),mean(test.acc),mean(sp.train.data), mean(sp.train.pred),
mean(sp.test.data),mean(sp.test.pred),
mean(csp.train.data), mean(csp.train.pred),
mean(csp.test.data),mean(csp.test.pred),
mean(pe.train.pred),
mean(pe.test.pred),
mean(EOpp.train.pred),
mean(EOpp.test.pred),
mean(EOdds.train.pred),
mean(EOdds.test.pred))
names(tmp) <- c("approach","data","depth","fair.type","fair.bound","train.acc",'test.acc',
"train.data.sp","train.pred.sp","test.data.sp","test.pred.sp",
"train.data.csp","train.pred.csp","test.data.csp","test.pred.csp",
"train.pred.pe","test.pred.pe",
"train.pred.EOpp","test.pred.EOpp",
"train.pred.EOdds","test.pred.EOdds")
# tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","train.acc",
#              'train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp','train.pred.EOdds')]
#
# tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'train.acc'))
tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","test.acc",
'test.pred.sp','test.pred.csp','test.pred.pe','test.pred.EOpp','test.pred.EOdds')]
tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'test.acc'))
tmp$fair.type <- factor(tmp$fair.type, levels = c('SP','CSP','PE','EOpp','EOdds'))
tmp$variable <- factor(tmp$variable, levels = c('train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp','train.pred.EOdds'))
g1 <- ggplot(data = subset(tmp,tmp$depth ==2), aes(x=(1-value)*100, y=test.acc*100)) +
geom_point()+#aes(size = fair.bound)
geom_text(aes(label = fair.bound),
vjust = "inward", hjust = "inward",check_overlap = TRUE, nudge_y = 5,nudge_x = 4,
show.legend = FALSE,size = 3) +
geom_line(aes(color = variable)) +
facet_grid(vars(fair.type), vars(variable))+
labs(x="Fairness (%)", y = "Accuracy (%)", linetype = "Constraint")+
theme(
# plot.title = element_text(size = 25),
axis.title = element_text(size = 29)
)
print(g1)
View(tmp)
tmp <- data
tmp <- tmp %>%
group_by(approach,data,depth, fair.type, fair.bound) %>%
summarise(mean(train.acc),mean(test.acc),mean(sp.train.data), mean(sp.train.pred),
mean(sp.test.data),mean(sp.test.pred),
mean(csp.train.data), mean(csp.train.pred),
mean(csp.test.data),mean(csp.test.pred),
mean(pe.train.pred),
mean(pe.test.pred),
mean(EOpp.train.pred),
mean(EOpp.test.pred),
mean(EOdds.train.pred),
mean(EOdds.test.pred))
names(tmp) <- c("approach","data","depth","fair.type","fair.bound","train.acc",'test.acc',
"train.data.sp","train.pred.sp","test.data.sp","test.pred.sp",
"train.data.csp","train.pred.csp","test.data.csp","test.pred.csp",
"train.pred.pe","test.pred.pe",
"train.pred.EOpp","test.pred.EOpp",
"train.pred.EOdds","test.pred.EOdds")
View(tmp)
tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","test.acc",
'test.pred.sp','test.pred.csp','test.pred.pe','test.pred.EOpp','test.pred.EOdds')]
View(tmp)
tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'test.acc'))
tmp <- data
tmp <- tmp %>%
group_by(approach,data,depth, fair.type, fair.bound) %>%
summarise(mean(train.acc),mean(test.acc),mean(sp.train.data), mean(sp.train.pred),
mean(sp.test.data),mean(sp.test.pred),
mean(csp.train.data), mean(csp.train.pred),
mean(csp.test.data),mean(csp.test.pred),
mean(pe.train.pred),
mean(pe.test.pred),
mean(EOpp.train.pred),
mean(EOpp.test.pred),
mean(EOdds.train.pred),
mean(EOdds.test.pred))
names(tmp) <- c("approach","data","depth","fair.type","fair.bound","train.acc",'test.acc',
"train.data.sp","train.pred.sp","test.data.sp","test.pred.sp",
"train.data.csp","train.pred.csp","test.data.csp","test.pred.csp",
"train.pred.pe","test.pred.pe",
"train.pred.EOpp","test.pred.EOpp",
"train.pred.EOdds","test.pred.EOdds")
# tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","train.acc",
#              'train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp','train.pred.EOdds')]
#
# tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'train.acc'))
tmp <- tmp[c("approach","data","depth","fair.type","fair.bound","test.acc",
'test.pred.sp','test.pred.csp','test.pred.pe','test.pred.EOpp','test.pred.EOdds')]
tmp <- melt(tmp, id.vars=c("approach","data","depth","fair.type","fair.bound",'test.acc'))
tmp$fair.type <- factor(tmp$fair.type, levels = c('SP','CSP','PE','EOpp','EOdds'))
# tmp$variable <- factor(tmp$variable, levels = c('train.pred.sp','train.pred.csp','train.pred.pe','train.pred.EOpp','train.pred.EOdds'))
tmp$variable <- factor(tmp$variable, levels = c('test.pred.sp','test.pred.csp','test.pred.pe','test.pred.EOpp','test.pred.EOdds'))
g1 <- ggplot(data = subset(tmp,tmp$depth ==2), aes(x=(1-value)*100, y=test.acc*100)) +
geom_point()+#aes(size = fair.bound)
geom_text(aes(label = fair.bound),
vjust = "inward", hjust = "inward",check_overlap = TRUE, nudge_y = 5,nudge_x = 4,
show.legend = FALSE,size = 3) +
geom_line(aes(color = variable)) +
facet_grid(vars(fair.type), vars(variable))+
labs(x="Fairness (%)", y = "Accuracy (%)", linetype = "Constraint")+
theme(
# plot.title = element_text(size = 25),
axis.title = element_text(size = 29)
)
print(g1)
if (forpres)
{
ggsave(paste(figure_path,"grid_test.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
} else {
ggsave(paste(figure_path,"grid_test.pdf",sep = ""),device = "pdf", width = 16, height = 11, units =  "in")
}
library(caret)
library(stringr)
library(outliers)
library(editrules)
library(dplyr)
rm(list=ls())
graphics.off()
#################################################################################################
#Functions
#################################################################################################
dataencoder <- function (data) {
#encoding data
must_convert<-sapply(data,is.factor)       # logical vector telling if a variable needs to be displayed as numeric
M2<-sapply(data[,must_convert],unclass)    # data.frame of all categorical variables now displayed as numeric
data_num<-cbind(data[,!must_convert],M2)
data_num <- as.data.frame(data_num)
for(tmp_f in names(data)){
data_num[[tmp_f]] = as.factor(data_num[[tmp_f]] )
data_num[[tmp_f]]  = droplevels(data_num[[tmp_f]] )
}
data_num
}
